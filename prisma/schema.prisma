generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Employee {
  id               String          @id @default(cuid())
  employeeId       String          @unique
  employeeName     String
  position         String?
  department       String?
  email            String?
  phone            String?
  joinDate         DateTime?
  status           String?
  avatar           String?
  birthDate        DateTime?
  address          String?
  emergencyContact String?
  bloodGroup       String?
  employeeType     String?
  manager          String?
  locationId       String?
  location         Location?       @relation(fields: [locationId], references: [id])
  salary           String?
  skills           Json?
  education        Json?
  documents        Json?
  reviews          Json?
  achievements     Json?
  attendances      Attendance[]
  leaveRequests    LeaveRequest[]
  ProjectMembers   ProjectMember[]
  payrolls         Payroll[]
  loans            Loan[]
}

model User {
  id                     String         @id @default(cuid())
  email                  String         @unique
  passwordHash           String
  isActive               Boolean        @default(true)
  locationId             String
  location               Location       @relation(fields: [locationId], references: [id])
  roles                  UserRole[]
  expenseSheets          ExpenseSheet[] @relation("ExpenseCreatedBy")
  approvedExpenseSheets  ExpenseSheet[] @relation("ExpenseApprovedBy")
  rejectedExpenseSheets  ExpenseSheet[] @relation("ExpenseRejectedBy")
  disbursedExpenseSheets ExpenseSheet[] @relation("ExpenseDisbursedBy")
  notifications          Notification[]
  budgets                Budget[]       @relation("BudgetCreatedBy")
  approvedBudgets        Budget[]       @relation("BudgetApprovedBy")
  createdAt              DateTime       @default(now())
  updatedAt              DateTime       @updatedAt
}

model Role {
  id    String     @id @default(cuid())
  name  String     @unique
  users UserRole[]
}

model UserRole {
  id     String @id @default(cuid())
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String
  role   Role   @relation(fields: [roleId], references: [id], onDelete: Cascade)
  roleId String

  @@unique([userId, roleId])
}

model Location {
  id                    String         @id @default(cuid())
  name                  String
  city                  String
  monthlyPettyCashLimit Float?
  users                 User[]
  employees             Employee[]
  expenseSheets         ExpenseSheet[]
  routes                Route[]        @relation("RouteLocation")
  vehicles              Vehicle[]      @relation("VehicleLocation")
  budgets               Budget[]

  @@unique([name, city])
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  DISBURSED
}

enum ExpenseType {
  CASH_LOADERS
  CLAIMABLES_PAYMENT
  CLEANING_ITEMS
  CONSULTANCY_CHARGES
  CONTAINER_UNLOADING_CHARGES
  COOLER_RENTAL
  COURIER_CHARGES
  DAILY_KITCHEN_EXP
  DMS_PAYMENT
  ELECTRICITY_BILL
  EMPLOYEE_ACCOMODATION_EXP
  EMPLOYEE_MOBILE_EXP
  EMPLOYEE_TRAVELLING_EXP
  EMPTY_SORTING
  ENTERTAINMENT
  EOBI
  FUEL_FOR_BIKE
  GAS_BILL
  INTERNET_BILL
  LEGAL_CHARGES
  LOADERS_ACCOUMODATION_EXP
  LOADING_CHARGES
  MEETING_EXP
  PACKING_MATERIAL
  PRINTER_SERVICE
  PRINTING_STATIONERY
  REPAIR_MAINT_GENERAL
  REPAIR_MAINT_VEHICLE
  REPAIR_MAINT_WAREHOUSE
  RIKSHAW_RENTAL
  SECP_FEE
  SECURITY_CAMERA_SERVICE
  TAX_PAYMENT
  TOLLS_TAXES
  TRAFFIC_POLICE
  VEHICLE_CHALLAN
  VEHICLE_FUEL
  VEHICLE_RENTAL
  VEHICLES_RENT
  WAREHOUSE_RENT
  WORKER_WELFARE
  INVESTOR_PAYMENT 
  VEHICLE_PARKING
  VEHICLE_PASSING
  GUARD_TEA_EXP
  GARBAGE_COLLECTION
  FIXED_ASSET
  INCENTIVE_PAYMENT
  RAMZAN_IFTAR
  WATER_BILL
  RGB_BREAKAGE_WAREHOUSE_PLANT
  AUDIT_EXPENSE
  BANK_CHARGES
  BAD_DEBTS_EXPENSES
  BIKE_REPAIR
  CHARITY_DONATION
  EID_BONUS_EXPENSE
  EMPTY_GLASS_SALE_DISCOUNT
  EXTRA_DISCOUNT_EXPENSES
  EXTRA_SUPPLY_EXPENSES
  FEE_AND_SUBSCRIPTIONS
  FINE_PENALTIES
  FOC_STOCK_OFFICE_USE
  GROUP_LIFE_HEALTH_INSURANCE_EXPENSE
  HEAD_OFFICE_EXPENSE_ACCOUNT
  INSURANCE_EXP_LEASED_VEHICLES
  LOSS_GAIN_ASSETS_REVERSAL_PRICE_STOCKS
  LOW_FILL_BRUST_PTN_SHORT
  MANAGEMENT_EXPENSES
  MARK_UP_ON_LEASED_VEHICLES
  MEDICAL_EXPENSE
  SALARY_AND_WAGES
  SOCIAL_SECURITY_EXPENSES
  STAFF_ANNUAL_LEAVE_ENCASHMENT_EXPENSES
  TRANSPORTATION_CHARGES
  UNIFORM_EXPENSES_PSO_DM
  ZAKAT_EXPENSES
}

model ExpenseSheet {
  id            String              @id @default(cuid())
  category      String              @default("Expense")
  expenseType   ExpenseType
  items         Json?
  details       String?
  amount        Float
  status        ExpenseStatus       @default(PENDING)
  disburseType  String              @default("Cash")
  locationId    String
  location      Location            @relation(fields: [locationId], references: [id])
  routeId       String?
  route         Route?              @relation(fields: [routeId], references: [id])
  vehicleId     String?
  vehicle       Vehicle?            @relation(fields: [vehicleId], references: [id])
  createdById   String
  createdBy     User                @relation("ExpenseCreatedBy", fields: [createdById], references: [id])
  approvedById  String?
  approvedBy    User?               @relation("ExpenseApprovedBy", fields: [approvedById], references: [id])
  approvedAt    DateTime?
  rejectedById  String?
  rejectedBy    User?               @relation("ExpenseRejectedBy", fields: [rejectedById], references: [id])
  rejectedAt    DateTime?
  disbursedById String?
  disbursedBy   User?               @relation("ExpenseDisbursedBy", fields: [disbursedById], references: [id])
  disbursedAt   DateTime?
  accountTitle  String?
  accountNo     String?
  bankName      String?
  chequeDate    DateTime?
  disbursedAmount Float?
  attachments   ExpenseAttachment[]
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
}

model ExpenseAttachment {
  id        String       @id @default(cuid())
  sheetId   String
  sheet     ExpenseSheet @relation(fields: [sheetId], references: [id], onDelete: Cascade)
  url       String
  fileKey   String
  fileName  String
  fileType  String
  fileSize  Int
  createdAt DateTime     @default(now())
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  title     String
  message   String?
  link      String?
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
}

model Attendance {
  id             String   @id @default(cuid())
  employeeId     String
  employee       Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  date           DateTime
  checkIn        String?
  checkOut       String?
  checkInStatus  String?
  checkOutStatus String?
  workingHours   Float?
  status         String?
}

model LeaveRequest {
  id           String    @id @default(cuid())
  employeeId   String
  employee     Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeName String?
  leaveType    String?
  startDate    DateTime?
  endDate      DateTime?
  days         Int?
  reason       String?
  status       String?
}

model Project {
  id        String          @id @default(cuid())
  name      String
  client    String?
  startDate DateTime?
  deadline  DateTime?
  progress  Int?
  status    String?
  members   ProjectMember[]
}

model ProjectMember {
  id         String   @id @default(cuid())
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  projectId  String
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employeeId String
}

model Payroll {
  id            String    @id @default(cuid())
  employeeId    String
  employee      Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  amount        Float
  periodStart   DateTime?
  periodEnd     DateTime?
  paidAt        DateTime?
  paymentMethod String?
  status        String?
  notes         String?
}

model Loan {
  id                 String    @id @default(cuid())
  employeeId         String
  employee           Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  principalAmount    Float
  issuedAt           DateTime?
  dueAt              DateTime?
  balance            Float?
  installments       Int?
  monthlyInstallment Float?
  status             String?
  notes              String?
}

model Route {
  id            String         @id @default(cuid())
  routeNo       String
  name          String
  description   String?
  isActive      Boolean        @default(true)
  locationId    String
  location      Location       @relation("RouteLocation", fields: [locationId], references: [id])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  expenseSheets ExpenseSheet[]

  @@unique([routeNo, locationId])
}

model Vehicle {
  id            String         @id @default(cuid())
  vehicleNo     String
  type          String?
  model         String?
  isActive      Boolean        @default(true)
  locationId    String
  location      Location       @relation("VehicleLocation", fields: [locationId], references: [id])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  expenseSheets ExpenseSheet[]

  @@unique([vehicleNo, locationId])
}

enum BudgetStatus {
  PENDING
  APPROVED
  REJECTED
}

model Budget {
  id            String       @id @default(cuid())
  amount        Float
  categories    Json?
  status        BudgetStatus @default(PENDING)
  month         Int          @default(2)
  year          Int          @default(2026)
  locationId    String
  location      Location     @relation(fields: [locationId], references: [id])
  createdById   String
  createdBy     User         @relation("BudgetCreatedBy", fields: [createdById], references: [id])
  approvedById  String?
  approvedBy    User?        @relation("BudgetApprovedBy", fields: [approvedById], references: [id])
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@unique([locationId, month, year])
}
